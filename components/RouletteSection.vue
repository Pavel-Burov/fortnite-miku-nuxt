<template>\n  <section>\n    <div class=\"container\">\n      <div class=\"roulette-bl\" ref=\"rouletteSection\">\n        <p class=\"roulette-bl-title\">Miku roulette</p>\n        <p class=\"roulette-bl-desc\">Be the first to get a chance to win V-Bucks</p>\n        \n        <div class=\"roulette-wrapper\">\n          <img class=\"selector\" src=\"~/assets/img/selector.svg\" alt=\"Selector\">\n          <div class=\"wheel\" ref=\"wheel\"></div>\n        </div>\n        <div class=\"roulette-btn-bg\">\n          <a class=\"roulette-btn\" id=\"spin\" ref=\"spinButton\" @click=\"handleSpin\">SPIN</a>\n          <p class=\"spin-loading\">Spinning</p>\n          <p class=\"spin-congratulations\">Congratulations!</p>\n        </div>\n        <div class=\"modal\" ref=\"modal\">\n          <div class=\"modal-content\">\n            <p class=\"modal-title\">CONGRATULATIONS!</p>\n            <p class=\"modal-desc\">Be the first to get a chance to win V-Bucks</p>\n            <div class=\"modal-img\">\n              <img ref=\"modalImage\" src=\"\" alt=\"Prize\">\n              <p ref=\"modalPrizeX\"></p>\n            </div>\n            <a class=\"modal-btn\" @click=\"claimPrize\">CLAIM NOW</a>\n          </div>\n        </div>\n      </div>\n    </div>\n  </section>\n</template>\n\n<script>\nexport default {\n  name: 'RouletteSection',\n  data() {\n    return {\n      isPersonalDomain: true,\n      continuousSpinInterval: null,\n      prizes: [\n        {img: 'prize1.png', x: 7},\n        {img: 'prize2.png', x: 5},\n        {img: 'prize3.png', x: 5},\n        {img: 'prize4.png', x: 10},\n        {img: 'prize4.png', x: 15},\n        {img: 'prize1.png', x: 8},\n        {img: 'prize1.png', x: 10},\n        {img: 'prize3.png', x: 8},\n        {img: 'prize2.png', x: 6},\n        {img: 'prize3.png', x: 7},\n        {img: 'prize2.png', x: 8},\n        {img: 'prize1.png', x: 12},\n        {img: 'prize4.png', x: 5},\n        {img: 'prize1.png', x: 5},\n        {img: 'prize2.png', x: 13}\n      ]\n    }\n  },\n  mounted() {\n    this.initWheel();\n    this.startContinuousSpin();\n    \n    setInterval(() => {\n      this.trackPrizeUnderSelector();\n    }, 100);\n  },\n  beforeDestroy() {\n    if (this.continuousSpinInterval) {\n      clearInterval(this.continuousSpinInterval);\n    }\n  },\n  methods: {\n    initWheel() {\n      const $wheel = this.$refs.wheel;\n      const shuffledPrizes = [...this.prizes];\n      this.shuffleArray(shuffledPrizes);\n      \n      let row = document.createElement('div');\n      row.className = 'row';\n      \n      shuffledPrizes.forEach(prize => {\n        const card = document.createElement('div');\n        card.className = 'card';\n        \n        const img = document.createElement('img');\n        img.width = '100%';\n        img.src = require(`~/assets/img/${prize.img}`);\n        \n        const prizeX = document.createElement('p');\n        prizeX.className = 'prize-x';\n        prizeX.textContent = `X${prize.x}`;\n        \n        card.appendChild(img);\n        card.appendChild(prizeX);\n        row.appendChild(card);\n      });\n      \n      for (let x = 0; x < 29; x++) {\n        $wheel.appendChild(row.cloneNode(true));\n      }\n    },\n    \n    shuffleArray(array) {\n      for (let i = array.length - 1; i > 0; i--) {\n        const j = Math.floor(Math.random() * (i + 1));\n        [array[i], array[j]] = [array[j], array[i]];\n      }\n    },\n    \n    startContinuousSpin() {\n      const $wheel = this.$refs.wheel;\n      const cardWidth = 150 + 5 * 2;\n      let currentPosition = 0;\n      \n      $wheel.style.transition = 'transform 0.1s linear';\n      \n      this.continuousSpinInterval = setInterval(() => {\n        currentPosition -= cardWidth * 0.1;\n        $wheel.style.transform = `translate3d(${currentPosition}px, 0px, 0px)`;\n      }, 100);\n    },\n    \n    stopContinuousSpin() {\n      clearInterval(this.continuousSpinInterval);\n      const $wheel = this.$refs.wheel;\n      $wheel.style.transition = '';\n    },\n    \n    handleSpin() {\n      const spinButton = this.$refs.spinButton;\n      \n      if (spinButton.classList.contains('disabled')) {\n        return;\n      }\n      \n      this.startSpinLogic();\n    },\n    \n    startSpinLogic() {\n      const spinButton = this.$refs.spinButton;\n      spinButton.classList.add('disabled');\n      this.stopContinuousSpin();\n      \n      spinButton.style.display = 'none';\n      document.querySelector('.spin-loading').style.display = 'block';\n      \n      const outcome = Math.floor(Math.random() * 15);\n      this.spinWheel(outcome);\n      \n      setTimeout(() => {\n        document.querySelector('.spin-loading').style.display = 'none';\n        document.querySelector('.spin-congratulations').style.display = 'block';\n        spinButton.classList.remove('disabled');\n      }, 6000);\n    },\n    \n    spinWheel(roll) {\n      const $wheel = this.$refs.wheel;\n      const order = [0, 11, 5, 10, 6, 9, 7, 8, 1, 14, 2, 13, 3, 12, 4];\n      const position = order.indexOf(roll);\n      \n      const rows = 12;\n      const card = 150 + 5 * 2;\n      let landingPosition = (rows * 15 * card) + (position * card);\n      \n      const randomize = Math.floor(Math.random() * 75) - (75 / 2);\n      landingPosition = landingPosition + randomize;\n      \n      const object = {\n        x: Math.floor(Math.random() * 50) / 100,\n        y: Math.floor(Math.random() * 20) / 100\n      };\n      \n      $wheel.style.transitionTimingFunction = `cubic-bezier(0,${object.x},${object.y},1)`;\n      $wheel.style.transitionDuration = '6s';\n      $wheel.style.transform = `translate3d(-${landingPosition}px, 0px, 0px)`;\n      \n      setTimeout(() => {\n        $wheel.style.transitionTimingFunction = '';\n        $wheel.style.transitionDuration = '';\n        \n        const resetTo = -(position * card + randomize);\n        $wheel.style.transform = `translate3d(${resetTo}px, 0px, 0px)`;\n        \n        const prize = this.trackPrizeUnderSelector();\n        if (prize) {\n          this.showModalWithPrize(prize);\n        }\n      }, 6000);\n    },\n    \n    showModalWithPrize(prize) {\n      this.$refs.modalImage.src = prize.img;\n      this.$refs.modalPrizeX.textContent = `X${prize.x}`;\n      \n      this.$refs.modal.classList.add('show');\n      document.body.classList.add('no-scroll');\n    },\n    \n    trackPrizeUnderSelector() {\n      const selector = document.querySelector('.selector');\n      const wheel = this.$refs.wheel;\n      \n      if (!selector || !wheel) return null;\n      \n      const selectorRect = selector.getBoundingClientRect();\n      const selectorCenter = selectorRect.left + (selectorRect.width / 2);\n      \n      const cards = wheel.querySelectorAll('.card');\n      let selectedCard = null;\n      \n      cards.forEach(card => {\n        const cardRect = card.getBoundingClientRect();\n        if (cardRect.left <= selectorCenter && cardRect.right >= selectorCenter) {\n          selectedCard = card;\n        }\n      });\n      \n      if (selectedCard) {\n        const img = selectedCard.querySelector('img').src;\n        const x = parseInt(selectedCard.querySelector('.prize-x').textContent.replace('X', ''));\n        return { img, x };\n      }\n      \n      return null;\n    },\n    \n    claimPrize() {\n      this.$router.push('/id/login');\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.roulette-bl {\n  background-color: #15161d;\n  border-radius: 15px;\n  padding: 30px 0 50px 0;\n  overflow: hidden;\n}\n\n.roulette-bl-title {\n  color: $light-title;\n  text-transform: uppercase;\n  text-align: center;\n  font-size: 50px;\n  font-family: 'HeadingNowItalic';\n}\n\n.roulette-bl-desc {\n  color: $light-text-secondary;\n  text-align: center;\n  font-size: 25px;\n}\n\n.roulette-btn-bg {\n  display: flex;\n  justify-content: center;\n}\n\n.roulette-btn {\n  display: inline-block;\n  background-color: $yellow-accent;\n  color: $yellow-dark;\n  padding: 0px 35px;\n  cursor: pointer;\n  font-size: 30px;\n  border-radius: 10px;\n  transition: transform 0.3s;\n  font-weight: bolder;\n  box-shadow: 0px 0px 14px rgba(57, 61, 6, 0.5);\n  \n  &:hover {\n    transform: scale(1.05);\n  }\n}\n\n.roulette-wrapper {\n  position: relative;\n  margin: 20px auto;\n  width: 90%;\n  max-width: 800px;\n  overflow: hidden;\n  height: 160px;\n}\n\n.selector {\n  position: absolute;\n  left: 50%;\n  top: 0;\n  transform: translateX(-50%);\n  height: 100%;\n  z-index: 2;\n  pointer-events: none;\n}\n\n.roulette-wrapper .wheel {\n  display: flex;\n  position: relative;\n}\n\n.roulette-wrapper .wheel .row {\n  display: flex;\n}\n\n.roulette-wrapper .wheel .row .card {\n  flex: 0 0 auto;\n  width: 150px;\n  margin: 0 5px;\n  position: relative;\n  border-radius: 8px;\n  overflow: hidden;\n}\n\n.prize-x {\n  position: absolute;\n  top: 5px;\n  right: 5px;\n  background-color: $yellow-dark;\n  color: $light-title;\n  padding: 3px 6px;\n  border-radius: 4px;\n  font-size: 14px;\n}\n\n.modal-img {\n  position: relative;\n}\n\n@media(max-width:600px) {\n  .modal-title {\n    font-size: 30px;\n  }\n  .roulette-bl-title {\n    font-size: 40px;\n  }\n  .roulette-bl-desc {\n    font-size: 20px;\n  }\n}\n</style>